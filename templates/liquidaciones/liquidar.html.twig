{% extends 'base.html.twig' %}

{% block title %}Liquidaciones Profesionales{% endblock %}
{% block panelTitle %}Liquidación de: <span style="text-transform: capitalize">{{ doctor.nombre }} {{ doctor.apellido }}</span><a class="btn btn-success" style="padding: 2px 16px;float: right;" href="{{ path('profesionales_index') }}">Volver</a>{% endblock %}
{% block body %}
    <div class="container-fluid">
        <table class="table table-responsive table-striped">
            <thead>
            <tr>
                <th colspan="2">
                    <div class="col-md-5" style="float: left;">
                        <div class="col-md-2" style="float: left;line-height: 35px;">
                            Desde:
                        </div>
                        <div class="col-md-10" style="float: left;">
                            <input id='from' type="date" class="js-datepicker form-control" value="{{ desde }}">
                        </div>
                    </div>
                    <div class="col-md-5" style="float: left;">
                        <div class="col-md-2" style="float: left;line-height: 35px;">
                            Hasta:
                        </div>
                        <div class="col-md-10" style="float: left;">
                            <input id='to' type="date" class="js-datepicker form-control" value="{{ hasta }}">
                        </div>
                    </div>
                    <div class="col-md-2" style="float: left;">
                        <select class="form-control" id="obraSocial">
                            <option value="0">Obra Social</option>
                            {% for key, obrasSocial in obrasSociales %}
                                <option value="{{ key }}" {% if key == obraSocialSelected %} selected="selected" {% endif %}>{{ obrasSocial }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </th>
                <th colspan="4">
                    <div class="col-md-4">
                        <div class="input-group">
                            <div class="input-group-append">
                                <a class="btn btn-outline-secondary" data-inactivo="false" data-url="{{ path('liquidar', {'periodo': 'mes', 'id': doctor.id}) }}" type="button" id="buscarPorFechas" style="padding: 10px;">
                                    <i class="fas fa-search"></i>
                                </a>
                                <a class="btn btn-outline-secondary" data-inactivo="false" type="button" href="{{ path('liquidar', {'periodo': 'mes', 'id': doctor.id}) }}" style="padding: 10px;">
                                    Limpiar
                                </a>
                            </div>
                        </div>

                    </div>
                </th>
            </tr>
            <tr>
                <th scope="col">Titulo</th>
                <th scope="col">Paciente</th>
                <th scope="col">O. Social</th>
                <th scope="col">Comenzó</th>
                <th scope="col">Finalizó</th>
                <th scope="col">Notas</th>
            </tr>
            </thead>
            <tbody>
        {% for booking in bookings %}
            <tr>
                <td>{{ booking.title }}</td>
                <td style="text-transform: capitalize">{{ booking.cliente.nombre }} {{ booking.cliente.apellido }}</td>
                <td>{{ obrasSociales[booking.cliente.obraSocial] }}</td>
                <td>{{ booking.beginAt | date('Y-m-d H:i:s') }}</td>
                <td>{{ booking.endAt | date('Y-m-d H:i:s') }}</td>
                <td>
                    {% if booking.notas | length > 0 %}
                        <a href="{{ path('notas_turno_list', {'id': booking.id}) }}">ver notas</a>
                    {% else %}
                        No tiene
                    {% endif %}
                </td>
            </tr>
            <tr id="notas-{{ booking.id }}" class="notas">
            </tr>
        {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>
        $('#from').on('change', function () {
            $('#to').attr("min", $('#from').val());
            $('#to').val($('#from').val());
        })
        $('#buscarPorFechas').on('click', function () {
            let url = $(this).data('url');
            let from = $('#from').val();
            let to = $('#to').val();
            let obraSocial = $('#obraSocial').val();

            url = url + '&desde=' + from + '&hasta=' + to + '&obraSocial=' + obraSocial;

            window.location.href = url;
        })
    </script>

{% endblock %}